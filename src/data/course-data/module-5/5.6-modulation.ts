/**
 * Module 5, Submodule 5.6: Chuy·ªÉn gi·ªçng (Modulation)
 */
import type { Submodule } from '../types'

export const SUBMODULE_5_6: Submodule = {
  id: '5.6',
  title: 'Chuy·ªÉn gi·ªçng',
  description: 'Ph√¢n bi·ªát Direct vs Pivot Chord modulation v√† hi·ªáu ·ª©ng t·∫°o ra',
  sections: ['theory', 'abcDemo'],
  theoryContent: `
## 1. Modulation l√† g√¨?

### ƒê·ªãnh nghƒ©a

**Modulation** (Chuy·ªÉn gi·ªçng) l√† vi·ªác **ƒë·ªïi key** (gi·ªçng) trong b√†i h√°t - t·ª´ C Major sang G Major ch·∫≥ng h·∫°n.

> üöó Modulation = "Sang s·ªë" trong √¢m nh·∫°c!

### T·∫°i sao modulate?

- TƒÉng **nƒÉng l∆∞·ª£ng** (key change l√™n)
- Thay ƒë·ªïi **mood** (Major ‚Üí minor)
- T·∫°o **surprise** v√† gi·ªØ interest

{{quiz:Modulation l√† g√¨?|Thay ƒë·ªïi tempo;*ƒê·ªïi key trong b√†i h√°t;Thay ƒë·ªïi volume|Modulation = chuy·ªÉn t·ª´ key n√†y sang key kh√°c}}

---

## 2. Direct Modulation üöõ

### "Truck Driver's Gear Change"

**Direct Modulation** = Nh·∫£y th·∫≥ng sang key m·ªõi, **kh√¥ng chu·∫©n b·ªã**!

> ƒêang C Major ‚Üí B√πm! ‚Üí D Major (l√™n 1 cung)

### ƒê·∫∑c ƒëi·ªÉm

- **ƒê·ªôt ng·ªôt**, kh√¥ng b√°o tr∆∞·ªõc
- Th∆∞·ªùng l√™n **+1/2 ho·∫∑c +1 cung**
- G·ªçi l√† "gear change" v√¨ gi·ªëng xe ƒë·ªïi s·ªë

### V√≠ d·ª• n·ªïi ti·∫øng

- "I Will Always Love You" - Whitney Houston (final chorus)
- "My Heart Will Go On" - Celine Dion
- "Love on Top" - Beyonc√© (l√™n 4 l·∫ßn li√™n ti·∫øp!)

{{quiz:Direct Modulation ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?|D√πng pivot chord ƒë·ªÉ chuy·ªÉn m∆∞·ª£t;*Nh·∫£y th·∫≥ng sang key m·ªõi, kh√¥ng chu·∫©n b·ªã;D√πng common tone|Direct = nh·∫£y th·∫≥ng, kh√¥ng chu·∫©n b·ªã, "truck driver gear change"}}

---

## 3. Pivot Chord Modulation

### Smooth Transition

**Pivot Chord** = H·ª£p √¢m thu·ªôc **c·∫£ 2 gi·ªçng**, d√πng l√†m "c·∫ßu n·ªëi".

### V√≠ d·ª•: C Major ‚Üí G Major

| Chord | Trong C Major | Trong G Major |
|-------|---------------|---------------|
| **Am** | vi | ii |
| **Em** | iii | vi |
| **D** | II (borrowed) | V |

Am c√≥ th·ªÉ l√† vi c·ªßa C **HO·∫∂C** ii c·ªßa G ‚Üí Pivot!

### Quy tr√¨nh

1. ƒêang ·ªü C Major: C - F - Am...
2. **Am** = pivot (vi c·ªßa C, ii c·ªßa G)
3. Am ‚Üí D7 ‚Üí G (ii-V-I trong G)
4. B√¢y gi·ªù ·ªü G Major!

{{quiz:Pivot Chord modulation ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?|Nh·∫£y th·∫≥ng kh√¥ng chu·∫©n b·ªã;*D√πng chord chung gi·ªØa 2 keys l√†m c·∫ßu n·ªëi;TƒÉng tempo|Pivot chord thu·ªôc c·∫£ 2 keys, d√πng l√†m "c·∫ßu n·ªëi" m∆∞·ª£t m√†}}

---

## 4. Common Modulation Types

### L√™n n·ª≠a cung (+1 semitone)

| T·ª´ | ƒê·∫øn | Effect |
|----|-----|--------|
| C | C#/Db | Dramatic lift! |
| G | Ab | Intense! |

### L√™n m·ªôt cung (+2 semitones)

| T·ª´ | ƒê·∫øn | Effect |
|----|-----|--------|
| C | D | Bright, energetic |
| G | A | Fresh, uplifting |

### Relative Key (Major ‚Üî minor)

| T·ª´ | ƒê·∫øn | Effect |
|----|-----|--------|
| C Major | A minor | Mood change (happy ‚Üí sad) |
| A minor | C Major | Mood change (sad ‚Üí hopeful) |

### Parallel Key (Major ‚Üí minor c√πng tonic)

| T·ª´ | ƒê·∫øn | Effect |
|----|-----|--------|
| C Major | C minor | Dark color shift |
| A minor | A Major | Bright surprise |

---

## 5. Nh·∫≠n bi·∫øt Modulation

### D·∫•u hi·ªáu

1. **Accidentals m·ªõi** xu·∫•t hi·ªán (th√™m #/‚ô≠)
2. **C·∫£m gi√°c "m·ªõi m·∫ª"** - scale thay ƒë·ªïi
3. Chord progression **kh√¥ng c√≤n diatonic** trong key c≈©

### V√≠ d·ª•

ƒêang C Major, th·∫•y **F#** xu·∫•t hi·ªán ‚Üí c√≥ th·ªÉ ƒëang modulate v·ªÅ G Major!

---

## 6. Modulation trong Pop Songs

### V·ªã tr√≠ ph·ªï bi·∫øn

- **Tr∆∞·ªõc Final Chorus**: TƒÉng energy l√™n max!
- **Bridge ‚Üí Chorus**: T·∫°o surprise effect
- **Sau solo**: Quay v·ªÅ v·ªõi key m·ªõi

### "Love on Top" - Beyonc√©

B√†i h√°t modulate **4 l·∫ßn** li√™n ti·∫øp trong ph·∫ßn cu·ªëi:

\`\`\`
Bb ‚Üí B ‚Üí C ‚Üí Db ‚Üí D (!!!)
\`\`\`

M·ªói l·∫ßn l√™n +1/2 cung = Energy ng√†y c√†ng cao!

---

## 7. Modulation Detection

### C√°ch nh·∫≠n bi·∫øt khi nghe

1. **C·∫£m gi√°c "lift"**: B√†i h√°t ƒë·ªôt nhi√™n "s√°ng h∆°n"
2. **Gi·ªçng ca kh√°c**: Ca sƒ© h√°t cao h∆°n
3. **Chord pattern l·∫∑p**: C√πng melody, kh√°c cao ƒë·ªô

### Th·ª≠ nghi·ªám

Nghe "I Will Always Love You", b·∫•m n√∫t khi b·∫°n nghe key change!

---

## 8. K·ªπ thu·∫≠t Modulation

### Direct (d·ªÖ)

1. K·∫øt th√∫c phrase ·ªü key c≈©
2. B·∫Øt ƒë·∫ßu phrase m·ªõi ·ªü key m·ªõi (th∆∞·ªùng +1 cung)

### Pivot (smooth)

1. T√¨m chord chung gi·ªØa 2 keys
2. Ch∆°i pivot chord
3. Ch∆°i V-I c·ªßa key m·ªõi

### Common Tone (m∆∞·ª£t nh·∫•t)

1. Gi·ªØ 1 n·ªët xuy√™n su·ªët
2. Chord thay ƒë·ªïi xung quanh n·ªët ƒë√≥
3. Listener kh√¥ng nh·∫≠n ra ƒë·ªïi key!

---

## üéØ T√≥m t·∫Øt

1. **Modulation** = ƒê·ªïi key trong b√†i h√°t
2. **Direct**: Nh·∫£y th·∫≥ng, ƒë·ªôt ng·ªôt ("gear change")
3. **Pivot**: D√πng chord chung, m∆∞·ª£t m√†
4. **+1/2 cung ho·∫∑c +1 cung** = ph·ªï bi·∫øn nh·∫•t
5. **Effect**: TƒÉng energy, thay ƒë·ªïi mood, surprise

> üí° **M·∫πo**: Nghe "Love on Top" ƒë·ªÉ hi·ªÉu power of modulation!
  `,
  abcDemos: [
    {
      id: '5.6.1',
      title: 'Gear Change Demo',
      description: 'Direct +1 step modulation: C Major ‚Üí D Major. Kh√¥ng chu·∫©n b·ªã, nh·∫£y th·∫≥ng l√™n! ƒê√¢y l√† "truck driver modulation" - ƒë∆°n gi·∫£n nh∆∞ng hi·ªáu qu·∫£, r·∫•t ph·ªï bi·∫øn trong Pop ballad final chorus.',
      abc: `X:1
M:4/4
L:1/4
K:C
C D E G | c B A G |
K:D
D E ^F A | d ^c B A|]`,
      interactive: true,
      playable: true,
    },
    {
      id: '5.6.2',
      title: 'Pivot Chord',
      description: 'Smooth transition: C Major ‚Üí G Major qua Am (pivot). Am = vi c·ªßa C V√Ä ii c·ªßa G. Am ‚Üí D7 ‚Üí G = ii-V-I trong G Major. M∆∞·ª£t m√†, listener kh√¥ng shock!',
      abc: `X:1
M:4/4
L:1/2
K:C
[CEG] [FAc] | [Ace] [D^FA] |
K:G
[GBd] [ceg]|]`,
      interactive: true,
      playable: true,
    },
    {
      id: '5.6.3',
      title: 'Relative Key Shift',
      description: 'C Major ‚Üî A minor: C√πng h√≥a bi·ªÉu, kh√°c tonic. ƒê√¢y l√† modulation "t·ª± nhi√™n nh·∫•t" v√¨ hai keys share t·∫•t c·∫£ n·ªët. Mood change t·ª´ vui ‚Üí bu·ªìn ho·∫∑c ng∆∞·ª£c l·∫°i.',
      abc: `X:1
M:4/4
L:1/4
K:C
C E G c | A, C E A|
K:Am
A, B, C D | E F G A|]`,
      interactive: true,
      playable: true,
    },
    {
      id: '5.6.4',
      title: 'Famous Modulations',
      description: 'Real song examples: Whitney Houston "I Will Always Love You" modulates t·ª´ A ‚Üí Bb ‚Üí B ·ªü final chorus. M·ªói l·∫ßn l√™n = emotional boost m·ªõi! Modulation l√† c√¥ng c·ª• c·∫£m x√∫c m·∫°nh m·∫Ω.',
      abc: `X:1
M:4/4
L:1/4
K:A
A B c d |
K:Bb
B c d e |
K:B
B, ^C ^D E|]`,
      interactive: true,
      playable: true,
    },
  ],
  exercises: [{ type: 'note-id', notes: ['C4', 'D4', 'E4', 'G4', 'A4'], questionCount: 5 }],
}
